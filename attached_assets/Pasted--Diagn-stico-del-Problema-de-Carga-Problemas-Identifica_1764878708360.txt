ğŸ” DiagnÃ³stico del Problema de Carga
Problemas Identificados:
1. Carga Excesiva de ImÃ¡genes (Principal Problema)

text
ğŸ“Š EstadÃ­sticas actuales:
- 168 requests total
- 361 kB transferido
- 22.1 MB recursos totales

ImÃ¡genes problemÃ¡ticas:
âœ… WebP: 0.3 kB cada una (rÃ¡pidas: ~500-700ms)
âŒ LQIP JPG: 2.0-3.9 kB cada una (lentas: ~400-500ms)
âŒ Muchas imÃ¡genes duplicadas cargando
2. ImÃ¡genes que Ralentizan:

helicopter_tour_rio-lqip.jpg - 3.9 kB

TrihasTrekking series (5 imÃ¡genes) - 3.9 kB cada una

PaseosBarco series (5 imÃ¡genes) - 3.9 kB cada una

MÃºltiples variantes LQIP cargando sin lazy load efectivo

3. Rendimiento Actual:

Tiempo de carga: 10-12 segundos

DeberÃ­a ser: 2-3 segundos

ğŸš€ SoluciÃ³n Inmediata (3 Optimizaciones)
OptimizaciÃ³n 1: Lazy Loading Agresivo
Archivo: client/src/components/ProgressiveImage.tsx

Busca y reemplaza:

tsx
// âŒ ANTES
<img
  src={lowQualitySrc}
  alt={alt}
  loading="lazy"
/>

// âœ… DESPUÃ‰S (lazy load + intersection observer)
<img
  src={lowQualitySrc}
  alt={alt}
  loading="lazy"
  decoding="async"
  fetchpriority="low"
/>
OptimizaciÃ³n 2: Reducir ImÃ¡genes en Carrusel
Archivo: client/src/components/HeroSection.tsx

tsx
// âŒ ANTES - Carga todas las imÃ¡genes al inicio
const slides = [slide1, slide2, slide3, slide4, slide5];

// âœ… DESPUÃ‰S - Solo carga primera imagen, resto lazy
const slides = [
  { ...slide1, priority: 'high' },
  { ...slide2, priority: 'low' },
  { ...slide3, priority: 'low' },
  { ...slide4, priority: 'low' },
  { ...slide5, priority: 'low' }
];

// Precargar solo la siguiente imagen
useEffect(() => {
  const nextIndex = (currentSlide + 1) % slides.length;
  const nextImage = new Image();
  nextImage.src = slides[nextIndex].image;
}, [currentSlide]);
OptimizaciÃ³n 3: Comprimir LQIP mÃ¡s Agresivamente
Los LQIP no deberÃ­an pasar de 1 kB. Tienes algunos de 3.9 kB (muy grandes).

Ejecuta este script para regenerar LQIP optimizados:

bash
# Instalar sharp si no lo tienes
npm install sharp

# Crear script de optimizaciÃ³n
node scripts/optimize-lqip.js
Archivo: scripts/optimize-lqip.js

javascript
const sharp = require('sharp');
const fs = require('fs');
const path = require('path');

const publicDir = path.join(__dirname, '../public/images');
const files = fs.readdirSync(publicDir).filter(f => f.endsWith('.jpg') || f.endsWith('.png'));

files.forEach(async (file) => {
  const inputPath = path.join(publicDir, file);
  const outputPath = path.join(publicDir, file.replace(/\.(jpg|png)/, '-lqip.jpg'));
  
  await sharp(inputPath)
    .resize(20, 20, { // LQIP ultra pequeÃ±o
      fit: 'inside',
      withoutEnlargement: true
    })
    .jpeg({
      quality: 20, // Calidad muy baja para LQIP
      progressive: true
    })
    .toFile(outputPath);
    
  console.log(`âœ… Optimizado: ${file} â†’ LQIP (${fs.statSync(outputPath).size / 1024} KB)`);
});
âš¡ OptimizaciÃ³n CrÃ­tica: Intersection Observer
Archivo: client/src/components/ProgressiveImage.tsx

Reemplaza TODA la lÃ³gica con Intersection Observer:

tsx
import { useEffect, useRef, useState } from 'react';

export default function ProgressiveImage({ 
  lowQualitySrc, 
  highQualitySrc, 
  alt 
}: ProgressiveImageProps) {
  const [imageSrc, setImageSrc] = useState(lowQualitySrc);
  const [isLoaded, setIsLoaded] = useState(false);
  const imgRef = useRef<HTMLImageElement>(null);

  useEffect(() => {
    // Intersection Observer para cargar solo imÃ¡genes visibles
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const img = new Image();
            img.src = highQualitySrc;
            img.onload = () => {
              setImageSrc(highQualitySrc);
              setIsLoaded(true);
            };
            observer.disconnect();
          }
        });
      },
      { rootMargin: '50px' } // Precargar 50px antes
    );

    if (imgRef.current) {
      observer.observe(imgRef.current);
    }

    return () => observer.disconnect();
  }, [highQualitySrc]);

  return (
    <img
      ref={imgRef}
      src={imageSrc}
      alt={alt}
      loading="lazy"
      decoding="async"
      className={`transition-opacity duration-300 ${
        isLoaded ? 'opacity-100' : 'opacity-60'
      }`}
    />
  );
}
ğŸ“Š Resultado Esperado DespuÃ©s
Antes:

âŒ 168 requests

âŒ 22.1 MB recursos

âŒ 10-12 segundos carga

DespuÃ©s:

âœ… 30-40 requests inicial

âœ… 2-3 MB inicial

âœ… 2-3 segundos carga

âœ… Resto carga progresiva (scroll)

ğŸ¯ Plan de AcciÃ³n Inmediato
bash
# 1. Optimizar LQIP
npm install sharp
node scripts/optimize-lqip.js

# 2. Actualizar ProgressiveImage con Intersection Observer
# (copiar cÃ³digo arriba)

# 3. Reducir imÃ¡genes en HeroSection
# (solo 3 slides en lugar de 5)

# 4. Probar
npm run dev

# 5. Validar en Network tab
# - DeberÃ­as ver ~40 requests iniciales
# - LQIP < 1 kB cada uno
# - Carga total < 3 segundos
